@page "/"
@using CaloriesTracker.Models

<h3>Daily Calories Tracker</h3>

<div class="form-container">
    <h4 class="mb-3">Add Meal</h4>
    <div class="mb-3">
        <label class="form-label">Meal Name</label>
        <InputText class="form-control" @bind-Value="inputMeal.MealName" />
    </div>
    <div class="mb-3">
        <label class="form-label">Date</label>
        <InputDate class="form-control" @bind-Value="inputMeal.Date" />
    </div>
    <div class="mb-3">
        <label class="form-label">Fullness: @((Fullness)inputMeal.Fullness)</label>
        <div class="food-icon-container">
            @foreach (var level in Enum.GetValues<Fullness>())
            {
                <button class="food-icon @(inputMeal.Fullness >= (int)level ? "active" : "")"
                        @onclick="() => SetFullness(level)">
                    🍔
                </button>
            }
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">Calories</label>
        <InputNumber class="form-control" @bind-Value="inputMeal.Calories" /> kcal
    </div>
    <div class="mb-3">
        <label class="form-label">Meal Type</label>
        <InputSelect @bind-Value="inputMeal.MealType" class="form-select">
            @foreach (var value in Enum.GetValues(typeof(MealType)))
            {
                <option value="@value">@value</option>
            }
        </InputSelect>
    </div>
    <div class="form-button-group">
        <button class="btn btn-primary" @onclick='() => UpsertMeal()'>Add</button>
    </div>
</div>

<h4>Breakfast</h4>
<ul>
    @foreach (var item in meals.Where(x => x.MealType == MealType.Breakfast))
    {
        <li>
            <InputText @bind-Value="item.MealName" />
            <InputDate @bind-Value="item.Date" />
            <div>
                <strong>Fullness: @((Fullness)item.Fullness)</strong>
            </div>
            <div class="food-icon-container">
                @foreach (var level in Enum.GetValues<Fullness>())
                {
                    <button class="food-icon-display @(item.Fullness >= (int)level ? "active" : "")">
                        🍔
                    </button>
                }
            </div>
            <InputNumber @bind-Value="item.Calories" /> kcal
            <InputSelect @bind-Value="item.MealType" class="form-select">
                @foreach (var value in Enum.GetValues(typeof(MealType)))
                {
                    <option value="@value">@value</option>
                }
            </InputSelect>
            <button class="btn btn-primary" @onclick='() => UpsertMeal(item)'>Edit</button>
            <button class="btn btn-secondary" @onclick='() => DeleteMeal(item.Id)'>Delete</button>
        </li>
    }
</ul>

<h4>Lunch</h4>
<ul>
    @foreach (var item in meals.Where(x => x.MealType == MealType.Lunch))
    {
        <li>
            <InputText @bind-Value="item.MealName" />
            <InputDate @bind-Value="item.Date" />
            <div>
                <strong>Fullness: @((Fullness)item.Fullness)</strong>
            </div>
            <div class="food-icon-container">
                @foreach (var level in Enum.GetValues<Fullness>())
                {
                    <button class="food-icon-display @(item.Fullness >= (int)level ? "active" : "")">
                        🍔
                    </button>
                }
            </div>
            <InputNumber @bind-Value="item.Calories" /> kcal
            <InputSelect @bind-Value="item.MealType" class="form-select">
                @foreach (var value in Enum.GetValues(typeof(MealType)))
                {
                    <option value="@value">@value</option>
                }
            </InputSelect>
            <button class="btn btn-primary" @onclick='() => UpsertMeal(item)'>Edit</button>
            <button class="btn btn-secondary" @onclick='() => DeleteMeal(item.Id)'>Delete</button>
        </li>
    }
</ul>

<h4>Dinner</h4>
<ul>
    @foreach (var item in meals.Where(x => x.MealType == MealType.Dinner))
    {
        <li>
            <InputText @bind-Value="item.MealName" />
            <InputDate @bind-Value="item.Date" />
            <div>
                <strong>Fullness: @((Fullness)item.Fullness)</strong>
            </div>
            <div class="food-icon-container">
                @foreach (var level in Enum.GetValues<Fullness>())
                {
                    <button class="food-icon-display @(item.Fullness >= (int)level ? "active" : "")">
                        🍔
                    </button>
                }
            </div>
            <InputNumber @bind-Value="item.Calories" /> kcal
            <InputSelect @bind-Value="item.MealType" class="form-select">
                @foreach (var value in Enum.GetValues(typeof(MealType)))
                {
                    <option value="@value">@value</option>
                }
            </InputSelect>
            <button class="btn btn-primary" @onclick='() => UpsertMeal(item)'>Edit</button>
            <button class="btn btn-secondary" @onclick='() => DeleteMeal(item.Id)'>Delete</button>
        </li>
    }
</ul>

<p>Total calories consumed today: @totalCalories kcal / @(dailyCaloriesGoal > 0 ? $"{dailyCaloriesGoal} kcal" : "Set your daily calories goal!")</p>

<style>
    .food-icon {
        font-size: 2rem;
        opacity: 0.3;
        transition: transform 0.2s ease, opacity 0.2s ease;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
    }

        .food-icon:hover {
            transform: scale(1.2);
            opacity: 0.8;
        }

        .food-icon.active {
            opacity: 1;
            filter: drop-shadow(0 0 4px #f59e0b); /* glowing amber highlight */
        }

    .food-icon-display {
        font-size: 2rem;
        opacity: 0.3;
        transition: transform 0.2s ease, opacity 0.2s ease;
        background: none;
        border: none;
        padding: 0;
    }

        .food-icon-display.active {
            opacity: 1;
            filter: drop-shadow(0 0 4px #f59e0b); /* glowing amber highlight */
        }

    .food-icon-container {
        margin-top: -3px;
    }

    .form-container {
        border: 1px solid #dee2e6;
        border-radius: 2rem;
        padding: 1.5rem;
    }

    .form-button-group {
        display: flex;
        justify-content: flex-end;
    }
</style>

@* <style>
    .slider {
        width: 100%;
        accent-color: #10b981; /* Tailwind emerald green */
        cursor: pointer;
    }

    /* Optional fancy gradient background */
    .slider::-webkit-slider-runnable-track {
        height: 8px;
        background: linear-gradient(to right,
            #22c55e 0%,    /* green */
            #eab308 50%,   /* yellow */
            #ef4444 100%); /* red */
        border-radius: 8px;
    }

    .slider::-webkit-slider-thumb {
        appearance: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: white;
        border: 2px solid #10b981;
        margin-top: -4px;
        transition: background 0.2s;
    }

    .slider::-webkit-slider-thumb:hover {
        background: #10b981;
    }
</style> *@